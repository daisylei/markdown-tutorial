---
title: "R and R Markdown Practice"
author: "Your name"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: html_document
---

<!-- This is the default setup chunk when you create a new R Markdown document-->
```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

This file should give you some practice with creating R Markdown documents and performing analyses with R.

# R Markdown Practice

In this section, you will practice using the YAML header to change output types and formatting. You'll also have an opportunity to add CSS/HTML code to make local formatting changes.

As a note, special characters like the at symbol and pound sign need to be escaped with a backslash in order for pandoc to render them as text rather than as functional units when knitting the document. When you try to use these symbols in the practice problems, just remember to remove the backslashes from my explanations.

## Output type

First, let's change this document from a simple HTML document to a presentation. Change the **output** to the HTML presentation format of your choosing (ioslides, Slidy, or `revealjs`). The documentation for all of the different formats is [here](https://rmarkdown.rstudio.com/lesson-11.html). Remember, if you choose to make a presentation with `revealjs`, you'll need to install the package first.

## Slides

You can create slides with headers by using the pound sign \#. Depending on the presentation format you choose, different numbers of \# will have different behaviors. You can change those behaviors in the YAML header.

You can also create slides without headers by putting four dashes \-\-\-\- on a line by themselves, as below. Try dividing up the text below into different slides.

----

## Formatting

Once you've changed the document to a presentation, you'll want to do some formatting. All three HTML presentation formats share [appearance and styles settings](https://bookdown.org/yihui/rmarkdown/html-document.html#appearance-and-style) with HTML documents in general. Try setting the **theme** and **highlight** styles. Depending on the presentation format you choose, you can also include additional parameters like footers, logos, transition styles, incremental bullets, etc. Refer to the [presentation documentation](https://rmarkdown.rstudio.com/lesson-11.html) for more details.

## Bibliography

Let's add a bibliography. We can create citations for the R packages that we're using in this report.

```{r bib}
# Source R script
source("data_cleaning.R", local = TRUE)

# Create bib file with citation information for all loaded packages
if (!file.exists("my_pkgs.bib")){
  
knitr::write_bib(x = pkg_list, file = "my_pkgs.bib", tweak = TRUE, width = NULL, 
    prefix = getOption("knitr.bib.prefix", "R-"))
  
}
```

Now that we've created a bibliography, let's add it to the YAML header. You'll also want to add the citation style language file that you want pandoc to use when creating the reference section at the end. I've included the APA 6 file in the folder for this tutorial, but you could add a different one that you prefer.

When pandoc goes to create the reference section, it needs to know which items to include. If you only want to include items with in-text citations, just use the cite key (the first line in each entry in the bib file) like this [@tidyverse2019]. You can also reference citations like this @plyr2011 without brackets to format it differently. If you want pandoc to include everything in the bib file, regardless of whether it has an in-text citation, add **nocite: "\@\*"** to the YAML header.

As a note, if you knit this document before adding the bib file to your YAML header, the cite keys will just appear as text. Once pandoc has your bib file, it will render the citations correctly.

## CSS/HTML

Let's say that I want to add an image. There are several ways to do this. The most basic markup way combines !, [caption], and (image path/name). Note that the caption will not appear if you do not put it on its own line.

![The Krusty Krab pizza! Is the pizza! For you and me!](images/spongebob_pizza.jpg)

If I want to control its size and position, there are a couple of ways to do this. One is to use HTML code to embed the image and change its formatting. I can also add a caption underneath.

<img style="right;" src="images/spongebob_pizza.jpg" width=40% height=40%>
<figcaption>... and my feet are killing me</figcaption>

Another way to add an image is to use an R chunk, as shown below. You can change the size, alignment, caption, and other properties of the image by setting the local chunk parameters. With both the HTML and chunk options, you can express the width and height with percentages, as I have, or with specific units.

```{r image_chunk, out.height="25%", out.width="25%", fig.align="center", fig.cap="Pizza Delivery"}
# This is a chunk of R code that adds an image
knitr::include_graphics("images/spongebob_pizza.jpg")
```

You can also use HTML to edit other aspects of an R Markdown document. For example, I can <font size = 5>change the font size</font>. I often do this for the references section at the end of a document (especially for a poster).

<!-- Try adding this line to the bottom of your document, after ## References: 
<font size=1><div id="refs"></div></font> -->

# R Practice

The data from the survey that you completed to give me a sense of your R and R Markdown experience is in the `dat` dataframe that we sourced from the data_cleaning.R file earlier. You can see the variable names and their descriptions in the table below.

```{r data_desc}
# Pull column names from dataset
fields <- colnames(dat)

# Make table with column names and descriptions
fields_tbl <- tibble(Fields = fields,
                     Descriptions = c("Familiarity with R", "Familiarity with R Markdown",
                              "Comfort with R", "Comfort with R Markdown",
                              "Types of experience with R", 
                              "Types of experience with R Markdown",
                              "Experience with LaTeX", "Experience with HTML",
                              "Potential tutorial topics"))

# Print field table
knitr::kable(fields_tbl) %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

Try adjusting the output parameters of this chunk to alter the size and placement of the graphs. You can also save the ggplot objects and then plot them at the same time to see if you can get them to appear side-by-side in your knitted document. 

If you want some `ggplot` practice, you can also try adding more formatting specifications (e.g., color, size, shape). 

If you want some more R practice, you could try manipulating the data so that you can put both R and R Markdown experience data in the same plot (and use `facet_wrap`).

```{r image_practice}
# See the data_cleaning.R document for information on how I processed these data
# By default, R will order strings alphabetically when plotting
# To establish the correct order (in this case, from no to lots of experience/familiarity/comfort), you need to create factors

# Create list of formatting specifications
# This is most helpful when you have lots of graphs that you want to format in the same way
# Instead of separating formatting specifications with + like you do when you're making the actual graph, just separate items with , in a list()
specs <- list(theme_classic(),
              xlab("Familiarity"),
              ylab("Comfort"))

# Plot familiarity by comfort with R Markdown
ggplot(data = dat, aes(x = familiarity_rmd, y = comfort_rmd)) +
  geom_jitter(stat = "identity") +
  ggtitle("Familiarity and Comfort with R Markdown") +
  specs

# Plot familiarity by comfort with R
ggplot(data = dat, aes(x = familiarity_r, y = comfort_r)) +
  geom_jitter(stat = "identity") +
  ggtitle("Familiarity and Comfort with R") +
  specs
```

If you want to have some more R practice, particularly with `tidyr` functions, try the exercises in the chunks below.

## Piping and mutating

```{r r_piping}
## Piping examples ##

# group_by() and summarise() work together
# group_by() tells summarise() which groups of variables to do some operation on
# The operation in this case is n(), which is like count in Excel

# Piping shorthand
dat %>% group_by(familiarity_r) %>% summarise(count = n())

# Piping explicit
dat %>% group_by(., familiarity_r) %>% summarise(., count = n())

# Intermediate variables with no piping
dat_group <- group_by(dat, familiarity_r)
summarise(dat_group, count = n())

# No piping
summarise(group_by(dat, familiarity_r), count = n())

## Mutating ##

dat <- dat %>%
  mutate(familiarity_r_recode = recode(familiarity_r,
                                       "None" = 1,
                                       "Low" = 2,
                                       "Moderate" = 3,
                                       "High" = 4))

# mutate() creates a new column (or you can overwrite an old one)
# The basic format is mutate(new_column = function(some operation))
# In this case, I made a new column that recoded the text-based responses for familiarity with R to numbers
# Try using group_by() and summarise(), this time getting the mean() of R familiarity

# your code here

# Now, try mutating the experience with LaTeX column

# your code here
```

## Gather

```{r r_gather}
# Two essentially tidyr functions are gather() and spread()
# They are the opposites of one another
# We can also use select() to pull specific columns

# Let's say that we want to put both LaTeX and HTML experience in the same column to create a long-form dataset
# We first want to select just the experience_latex and experience_html columns
# If we have all of the columns, everything will get gathered together
# Once we select the columns we want, we can gather them together
# We want to have a column that tells us which type of experience it is (HTML or LaTeX), and we also want to have the level of experience
experience <- dat %>% 
  select(experience_latex, experience_html) %>%
  gather(key = "type", value = "experience")

# Run View(experience) to see what the dataset looks like

# Let's add an ID column for each study participant
dat <- dat %>% mutate(id = 1:nrow(dat))

# Now we can do the same thing, but also maintain the information about which participant has which level of experience by specifying -id in gather()
# The - in front of the column name tells R that I don't want to gather that information into the two new columns; I want to maintain the id column
experience <- dat %>% 
  select(id, experience_latex, experience_html) %>%
  gather(key = "type", value = "experience", -id)

# Run View(experience) again to see what it looks like now

# If we want to keep all of the columns but still gather experience together, we can drop the select() function and just specify which columns we want to gather together
experience_all <- dat %>%
  gather("type", "experience", experience_html, experience_latex)

# Try gathering familiarity with R and R Markdown

# your code here
```

## Spread

```{r_spread}
```

## References